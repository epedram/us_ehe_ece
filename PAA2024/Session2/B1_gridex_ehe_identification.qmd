---
title: "PAA2024 - Extreme Heat and Cold Events Exposure Assessment with GridEX"
subtitle: "Exploring the extreme events intensity and grid surfaces"
author: "Pedram Fard"

format: html
editor: visual
---

## PAA2024 - Extreme Heat and Cold Events Exposure Assessment with GridEX

April 2024, PAA Annual Meeting

### Session 2B - Exploring the extreme events intensity and grid surfaces

Author: Pedram Fard, Researcher at Harvard Medical School\
email: pedram_fard\@hms.harvard.edu

Here we start with retrieving the actual gridded layers of EHE/ECE covering the continental United States. You'll then work with the stacked and cumulative layers presenting different temporal scales of extreme events.

```{r,  message=TRUE, warning=FALSE, error=TRUE}
## install.packages(c("sf", "terra", "tidyverse"))

library(sf)
library(terra)

# workshop_dataset <- "../Data"
# 
# # Check out the data folders for today's workshop
# list.files(workshop_dataset, full.names = TRUE)

daily_raster_dir <- "../Data/GridEX_C15_S526_T002_daily_raster_dataset"
list.files(daily_raster_dir)
```

### Inspect a sample day of extreme cold event (ECE)

[GridEX Naming Convention](https://docs.ghttps://docs.google.com/spreadsheets/d/1SWrflS3zi_ZPSobYhfe4LvvVgeQ3DJOW5tFHT9AQjeA/edit#gid=0)

We first select a layer from the dataset of daily rasters called "GridEX_C15_S526_T002_daily_raster_dataset". We then load the interpolated surface of extreme event intensity using "terra" package.

```{r}
list.files(daily_raster_dir, pattern = "ece")

ehce_daily_raster_22Jan02 <- rast(file.path(daily_raster_dir, "D2022-01-02_S526_T002_idw_ehce_grid.tif"))

class(ehce_daily_raster_22Jan02)
```

Then inspect properties of the loaded layer.

```{r}
dim(ehce_daily_raster_22Jan02)

#cell size
res(ehce_daily_raster_22Jan02)

#num cells
ncell(ehce_daily_raster_22Jan02)
```

```{r}
minmax(ehce_daily_raster_22Jan02)

#min_value <- minmax(ehce_daily_raster_22Jan02)[1,1]
#max_value <- minmax(ehce_daily_raster_22Jan02)[2,1]
```

### Map the spatial distribution of event intensity for a sample day
We also load the spatial layer of States boundaries to better visualize the extent of ECE
```{r}
us_states <- sf::st_read(file.path("../Data/Census_admin_boundaries","tigris_states_geo_CRS5070.gpkg"))

plot(ehce_daily_raster_22Jan02)
plot(us_states[2], add = T, col = NA) 
#plot(daily_events_2022_01_02[1], add = T)
```

### Map the event intensity for the next day of identified ECE

```{r}
ehce_daily_raster_22Jan03 <- rast(file.path(daily_raster_dir, "D2022-01-03_S526_T002_idw_ehce_grid.tif"))

plot(ehce_daily_raster_22Jan03)
plot(us_states[2], add = T, col = NA) 
```

### Explore the stacked dataset of ECE for a sample year (2022)

```{r}
ece_daily_stack_2022 <- rast(file.path(daily_raster_dir, "Y2022_S426_T102_ece_unified_grids_500_stack.tif"))
print(ece_daily_stack_2022)

names(ece_daily_stack_2022)
```

```{r}
plot(ece_daily_stack_2022)
```

### Navigating stacked layers

```{r}
plot(ece_daily_stack_2022$`2022-01-08`)

plot(us_states[2], add = T, col = NA) 
```

