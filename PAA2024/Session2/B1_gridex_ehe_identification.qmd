---
title: "PAA2024 - Extreme Heat and Cold Events Exposure Assessment with GridEX"
subtitle: "Exploring the extreme events intensity and grid surfaces"
author: "Pedram Fard"

format: html
editor: visual
---

## PAA2024 - Extreme Heat and Cold Events Exposure Assessment with GridEX

April 2024, PAA Annual Meeting

### Session 2B - Exploring the extreme events intensity and grid surfaces

Author: Pedram Fard, Researcher at Harvard Medical School\
email: pedram_fard\@hms.harvard.edu

Here we start with retrieving the actual gridded layers of EHE/ECE covering the continental United States. You'll then work with the stacked and cumulative layers presenting different temporal scales of extreme events.

```{r}
## install.packages(c("sf", "terra", "tidyverse"))

library(sf)
library(terra)

# workshop_dataset <- "../Data"
# 
# # Check out the data folders for today's workshop
# list.files(workshop_dataset, full.names = TRUE)

daily_data_dir <- "../Data/GridEX_C15_S526_T002_daily_raster_dataset"
list.files(daily_data_dir)
```

### Look into a sample day of extreme cold event and inspect the interpolated surface of extreme event intensity

```{r}
ehce_daily_raster_22Jan02 <- rast(file.path(daily_data_dir, "D2022-01-02_S526_T002_idw_ehce_grid.tif"))

class(ehce_daily_raster_22Jan02)
dim(ehce_daily_raster_22Jan02)
nlyr(ehce_daily_raster_22Jan02)

#cell size
res(ehce_daily_raster_22Jan02)

sf::st_crs(ehce_daily_raster_22Jan02)$epsg

#num cells
ncell(ehce_daily_raster_22Jan02)
```

```{r}
min_value <- minmax(ehce_daily_raster_22Jan02)[1,1]
max_value <- minmax(ehce_daily_raster_22Jan02)[2,1]
```

### Load the spatial layer of States boundaries and map the spatial distribution of event intensity for a sample day

```{r}
us_states <- sf::st_read(file.path("../Data/Census_admin_boundaries","tigris_states_geo_CRS5070.gpkg"))
plot(ehce_daily_raster_22Jan02)
plot(us_states[2], add = T, col = NA) 
```

### Map the event intensity for the next day of identified ECE

```{r}
ehce_daily_raster_22Jan03 <- rast(file.path(daily_data_dir, "D2022-01-03_S526_T002_idw_ehce_grid.tif"))

plot(ehce_daily_raster_22Jan03)
plot(us_states[2], add = T, col = NA) 
```

### Explore the stacked dataset of ECE for a sample year (2022)

```{r}
ece_daily_stack_2022 <- rast(file.path(daily_data_dir, "Y2022_S426_T102_ece_unified_grids_500_stack.tif"))
print(ece_daily_stack_2022)
```

```{r}
plot(ece_daily_stack_2022)
```

```{r}
names(ece_daily_stack_2022)

plot(ece_daily_stack_2022$`2022-01-08`)
```

### Explore the total impact of ECEs for a sample year (2022)

```{r}
yearly_data_dir <- "../Data/GridEX_C15_S426_T902_cumulative_raster_dataset"
#list.files(yearly_data_dir)

total_ece_days_2022 <- rast(file.path(yearly_data_dir, "Y2022_S426_T102_ece_unified_grids_500_cumulative.tif"))

print(total_ece_days_2022)

minmax(total_ece_days_2022)
#minmax(total_ece_days_2022)[2,1]

plot(total_ece_days_2022)
plot(us_states[2], add = T, col = NA)
```

